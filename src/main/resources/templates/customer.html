<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Data Viewer</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            font-size: 32px;
            margin-bottom: 30px;
        }
        .market-data {
            font-size: 24px;
            margin-bottom: 20px;
        }
        .data-item {
            margin-bottom: 16px;
        }
        .label {
            color: #666;
            font-size: 16px;
            margin-bottom: 4px;
        }
        .value {
            font-size: 28px;
            font-weight: 600;
        }
        .value.positive {
            color: #059669;
        }
        .value.negative {
            color: #dc2626;
        }
        .loading {
            font-size: 20px;
            color: #666;
        }
    </style>
</head>
<script>
    function fetchMarket() {
        const stockSelect = document.getElementById('stockSelect');
        const marketData = document.getElementById('marketData');
        const loading = document.getElementById('loading');
        const selectedStock = stockSelect.value;
        const selectedStockName = stockSelect.options[stockSelect.selectedIndex].text;

        if (!selectedStock) {
            marketData.innerHTML = '';
            return;
        }

        loading.style.display = 'block';
        marketData.style.display = 'none';

        fetch(`/customer/market/${selectedStock}`)
            .then(response => response.json())
            .then(data => {
                loading.style.display = 'none';
                marketData.style.display = 'block';

                if (Object.keys(data).length === 0) {
                    marketData.innerHTML = '<div class="no-data">No market data available for this stock.</div>';
                    return;
                }

                let html = `<h2>${selectedStockName}</h2>`;
                
                // Display price data
                if (data.price) {
                    const price = data.price;
                    html += createDataItem('Current Price', `$${price.current.toFixed(2)}`);
                    
                    const change = price.current - price.previous;
                    const changePercent = (change / price.previous * 100).toFixed(2);
                    const changeClass = change >= 0 ? 'positive' : 'negative';
                    const changeSign = change >= 0 ? '+' : '';
                    
                    html += createDataItem('Price Change', 
                        `<span class="${changeClass}">${changeSign}$${change.toFixed(2)} (${changeSign}${changePercent}%)</span>`);
                }

                // Display volume data
                if (data.volume) {
                    html += createDataItem('Volume', data.volume.current.toLocaleString());
                    
                    const volChange = ((data.volume.current - data.volume.previous) / data.volume.previous * 100).toFixed(2);
                    const volChangeClass = volChange >= 0 ? 'positive' : 'negative';
                    const volChangeSign = volChange >= 0 ? '+' : '';
                    
                    html += createDataItem('Volume Change', 
                        `<span class="${volChangeClass}">${volChangeSign}${volChange}%</span>`);
                }

                marketData.innerHTML = html;
            })
            .catch(error => {
                console.error('Error:', error);
                loading.style.display = 'none';
                marketData.style.display = 'block';
                marketData.innerHTML = '<div class="error">Error loading market data.</div>';
            });
    }

    function createDataItem(label, value) {
        return `
            <div class="data-item">
                <div class="label">${label}</div>
                <div class="value">${value}</div>
            </div>
        `;
    }
</script>

<body>
    <div class="container">
        <h1>Market Data</h1>
        <div class="content">
            <select id="stockSelect" onchange="fetchMarket()">
                <option value="">Select a stock</option>
                <option value="AAPL">Apple (AAPL)</option>
                <option value="GOOGL">Google (GOOGL)</option>
                <option value="MSFT">Microsoft (MSFT)</option>
                <option value="TSLA">Tesla (TSLA)</option>
                <option value="AMZN">Amazon (AMZN)</option>
            </select>
            <div id="loading" class="loading" style="display: none;">Loading market data...</div>
            <div id="marketData" class="market-data"></div>
        </div>
    </div>
</body>
</html>

